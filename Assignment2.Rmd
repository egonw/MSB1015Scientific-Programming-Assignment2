---
title: "Assignment2"
author: "Raphael Stolpe"
date: "9/23/2019"
output: html_document
---

```{r setup, include=FALSE}
library(XML)
library(rcdk)
#library(rJava)
install.packages("WikidataQueryServiceR")
library(WikidataQueryServiceR)
```

```{r query}


#Alkanes
query <- 'SELECT ?comp ?compLabel ?bp ?bpUnit ?bpUnitLabel ?CC WHERE {   ?comp wdt:P31/wdt:P279* wd:Q41581 ;   wdt:P233 ?CC ;     p:P2102 [         ps:P2102 ?bp ;           psv:P2102/wikibase:quantityUnit  ?bpUnit         ] .   SERVICE wikibase:label { bd:serviceParam wikibase:language "[AUTO_LANGUAGE],en". } } '
unitquery <- '
      SELECT DISTINCT ?alkane ?alkaneLabel ?boilingpoint ?unit ?unitLabel ?smiles WHERE {
          ?alkane (wdt:P31|wdt:P279) wd:Q11173;
            rdfs:label ?alkaneLabel;
            wdt:P2102 ?boilingpoint;
            wdt:P233 ?smiles;
  OPTIONAL {
   # unit 
    ?alkane p:P2102/psv:P2102 [  wikibase:quantityUnit       ?unit ].}
          FILTER(STRENDS(?alkaneLabel, "ane"))
          FILTER((LANG(?alkaneLabel)) = "en")
          SERVICE
        }'
r <- query_wikidata(query)
labels <- c("C", "F", "K")
units.factor <- factor(r$unit, levels = labels)




```

```{r}

smiles <- r$CC
parsed_smiles <- parse.smiles(smiles, kekulise=TRUE)

descNames <- c(
'org.openscience.cdk.qsar.descriptors.molecular.KierHallSmartsDescriptor',
'org.openscience.cdk.qsar.descriptors.molecular.APolDescriptor'
)

descs <- eval.desc(parsed_smiles, descNames)


```

```{r}
library(pls)

data <- data.frame(r$bp, descs)
set.seed(42)
rows <- sample(nrow(data))
data <- data[rows, ]
split <- round(nrow(data)*0.8)

train <- data[1:split, ]
test <- data[(split+1):nrow(data), ]
ytest <- test$r.bp
test <- test[, 2:ncol(test)]


mdl <- plsr(data$r.bp ~., ncomp = 10, data = data, validation = "CV")
predicted <- predict(mdl, test)
```
## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
